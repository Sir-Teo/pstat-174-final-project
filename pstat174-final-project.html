<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.247">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>pstat174-final-project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="pstat174-final-project_files/libs/clipboard/clipboard.min.js"></script>
<script src="pstat174-final-project_files/libs/quarto-html/quarto.js"></script>
<script src="pstat174-final-project_files/libs/quarto-html/popper.min.js"></script>
<script src="pstat174-final-project_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="pstat174-final-project_files/libs/quarto-html/anchor.min.js"></script>
<link href="pstat174-final-project_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="pstat174-final-project_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="pstat174-final-project_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="pstat174-final-project_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="pstat174-final-project_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="abstract" class="level3">
<h3 class="anchored" data-anchor-id="abstract">Abstract</h3>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<section id="the-hospitality-industry" class="level3">
<h3 class="anchored" data-anchor-id="the-hospitality-industry">The Hospitality Industry</h3>
<p>The <strong>hospitality industry</strong>, using the definition from wikipedia, is a broad category of fields within the service industry that includes lodging, food and drink service, event planning, theme parks, travel and tourism. It includes hotels, tourism agencies, restaurants and bars. As of 2020,, the United States Department of Labor Standard Industrial Classification (SIC) defines the hospitality industry more broadly, including</p>
<ul>
<li>Hotels and Motels</li>
<li>Eating and Drinking Places</li>
<li>Arrangement of Passenger Transportation like travel agencies</li>
</ul>
<p>The entire industry worth more than 500 billion dollars. Thus it is important to make a meaningful forcast to its components and learn insights about it. Therefore, I would dedicate this project to forcast <strong>the total number of employees across time</strong>.</p>
</section>
<section id="the-dataset." class="level3">
<h3 class="anchored" data-anchor-id="the-dataset.">The Dataset.</h3>
<p>I obtained this dataset from <a href="https://www.kaggle.com/datasets/gabrielsantello/hospitality-employees-time-series-dataset/code">Kaggle</a>. This is a simple dataset consisting of just two columns, the first column is <code>Date</code>, which takes record monthly from January 1st, 1990 to December 1st, 2018. The second column is the <code># Employees</code>, which is the Average of employees each month (in thousands). There are a total of 348 valid rows.</p>
</section>
<section id="techniques" class="level3">
<h3 class="anchored" data-anchor-id="techniques">Techniques</h3>
<p>In the entire process of forcasting, I used techniques taught in my PSTAT 174/274 class including</p>
<ul>
<li>Visualization techniques</li>
<li>transformation</li>
<li>differencing</li>
<li>Model identification</li>
<li>acf/pacf discussion</li>
<li>Model estimation</li>
<li>Check of stationarity/invertibility</li>
<li>Diagnostic Checking</li>
<li>Forecasting</li>
</ul>
</section>
<section id="results-and-conclusions" class="level3">
<h3 class="anchored" data-anchor-id="results-and-conclusions">Results and Conclusions</h3>
</section>
</section>
<section id="the-forcasting" class="level2">
<h2 class="anchored" data-anchor-id="the-forcasting">The Forcasting</h2>
<section id="plot-and-analyze-the-time-series." class="level3">
<h3 class="anchored" data-anchor-id="plot-and-analyze-the-time-series.">Plot and analyze the time series.</h3>
<p>We will first set the working directory and load the dataset</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"/Users/teo/Desktop/pstat-174-final-project"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1205</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>hos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/HospitalityEmployees.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>employees <span class="ot">&lt;-</span> hos<span class="sc">$</span>Employees</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>nt <span class="ot">&lt;-</span> <span class="fu">length</span>(employees)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>tsdat <span class="ot">&lt;-</span> <span class="fu">ts</span>(employees, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2018</span>,<span class="dv">12</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(tsdat, <span class="at">main =</span> <span class="st">"Raw Data"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">mean</span>(employees), <span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-2-1.png" class="img-fluid"></p>
<p>Some immediate obseravtion of this dataset is that:</p>
<ul>
<li>there is a linearity in the dataset</li>
<li>there is also an obvious seasonality</li>
<li>We have relatively constant variance (ignoring the abnormality in 2008) and a non-constant mean</li>
</ul>
<p>more specifically, we witness <strong>a drop of employees in 2008-2009</strong>, which is probably due to the global economic crisis that took place in 2008.</p>
<p>Now we partition the data into a training and testing set. And we leave 24 data points for verification.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>employees.training <span class="ot">&lt;-</span> employees[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">323</span>)]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>employees.test <span class="ot">&lt;-</span> employees[<span class="fu">c</span>(<span class="dv">324</span><span class="sc">:</span><span class="dv">348</span>)]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(employees.training)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(employees.training <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(employees.training)))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">mean</span>(employees), <span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-3-1.png" class="img-fluid"></p>
<section id="histogram" class="level4">
<h4 class="anchored" data-anchor-id="histogram">Histogram</h4>
<p>And we will also plot out the histogram to verify the variance</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(employees.training, <span class="at">col=</span><span class="st">"light blue"</span>, <span class="at">xlab=</span><span class="st">""</span>, <span class="at">main=</span><span class="st">"histogram; employee data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-4-1.png" class="img-fluid"></p>
<p>And indeed, we see that the histogram skewed a little. And we can treat it as constant variance. So we dont need a transformation.</p>
</section>
<section id="histogram-of-raw-data" class="level4">
<h4 class="anchored" data-anchor-id="histogram-of-raw-data">Histogram of Raw Data</h4>
<p>We also plot out the ACF to check seasonality and trend</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(employees.training,<span class="at">lag.max=</span><span class="dv">40</span>, <span class="at">main=</span><span class="st">"ACF of the Airpass Data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-5-1.png" class="img-fluid"></p>
<p>And indeed, ACFs remain large and periodic (a little), so we might consider differencing.</p>
</section>
</section>
<section id="transformation-and-differencing" class="level3">
<h3 class="anchored" data-anchor-id="transformation-and-differencing">Transformation and Differencing</h3>
<section id="transformation" class="level4">
<h4 class="anchored" data-anchor-id="transformation">Transformation</h4>
<p>As stated in the previous section, no transformation required for this dataset</p>
</section>
<section id="differencing" class="level4">
<h4 class="anchored" data-anchor-id="differencing">Differencing</h4>
<p>We will first make a decomposition of the time series</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">ts</span>(employees.training, <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>decomp <span class="ot">&lt;-</span> <span class="fu">decompose</span>(y)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(decomp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-6-1.png" class="img-fluid"></p>
<p>we see that a decomposition of the time series shows seasonality and a linear trend, despite a small drop at 2008-2009. Therefore, we will difference the data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(employees.training)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 48721.73</code></pre>
<p>Our time series has variance of 40626.52, now differencing at lag 12</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>employees_lag12 <span class="ot">&lt;-</span> <span class="fu">diff</span>(employees.training,<span class="at">lag =</span> <span class="dv">12</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(employees_lag12, <span class="at">main=</span><span class="st">"U_t differenced at lag 12"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(employees_lag12 <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(employees_lag12)))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">mean</span>(employees_lag12), <span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-8-1.png" class="img-fluid"></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(employees_lag12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 1024.479</code></pre>
<p>And now the variance is 979, which is significantly lower. But we still have large variance and a non-zero mean. The ACF of the differenced series at lag 12 looks like</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(employees_lag12, <span class="at">lag.max=</span><span class="dv">40</span>, <span class="at">main=</span><span class="st">"ACF of the U_t, differenced at lag 12"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-9-1.png" class="img-fluid"></p>
<p>We see that seasonality no longer apparent, and the ACFs are decaying slowly, meaning that the series is still non stationary.</p>
<p>We continue differencing at lag 1,</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>employees_stat <span class="ot">&lt;-</span> <span class="fu">diff</span>(employees_lag12,<span class="at">lag =</span> <span class="dv">1</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(employees_stat, <span class="at">main=</span><span class="st">"U_t differenced at lag 12 &amp; lag 1"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(employees_stat <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(employees_stat)))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">mean</span>(employees_stat), <span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-10-1.png" class="img-fluid"></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(employees_stat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 46.56826</code></pre>
<p>We see that now the variance is only 47.71, and the plot looks stationary, with constant mean and variance and looks like white noise. So we achieved our purpose. We further verify this observation by historgram.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(employees_stat, <span class="at">density=</span><span class="dv">20</span>,<span class="at">breaks=</span><span class="dv">20</span>, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">xlab=</span><span class="st">""</span>, <span class="at">prob=</span><span class="cn">TRUE</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>m<span class="ot">&lt;-</span><span class="fu">mean</span>(employees_stat)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>std<span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(employees_stat))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>( <span class="fu">dnorm</span>(x,m,std), <span class="at">add=</span><span class="cn">TRUE</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-11-1.png" class="img-fluid"></p>
<p>The histogram looks much more normal. We will show the ACF and PACF on the next section.</p>
</section>
<section id="plot-and-analyze-acf-and-pacf-to-preliminary-identify-your-models" class="level4">
<h4 class="anchored" data-anchor-id="plot-and-analyze-acf-and-pacf-to-preliminary-identify-your-models">Plot and analyze ACF and PACF to preliminary identify your models</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(employees_stat, <span class="at">lag.max=</span><span class="dv">40</span>, <span class="at">main=</span><span class="st">"ACF of the U_t, differenced at lags 12 and 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-12-1.png" class="img-fluid"></p>
<p>The ACFs outside of of the confidence interval are at <strong>lag 2, 5, 12</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(employees_stat, <span class="at">lag.max=</span><span class="dv">40</span>, <span class="at">main=</span><span class="st">"PACF of the U_t, differenced at lags 12 and 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-13-1.png" class="img-fluid"></p>
<p>The PACFs outside of of the confidence interval are at <strong>lag 2, 5, 12, 22, 24</strong>. We can choose model parameters as follows. Notice that there seem to be an exponential decay at lag 12, 24, 36, so we choose <em>Q</em> = 0</p>
<p><em>p</em> = 0, 2, 5  <em>d</em> = 1  <em>q</em> = 0, 2, 5  <em>P</em> = 1  <em>D</em> = 1  <em>Q</em> = 0  <em>s</em> = 12</p>
</section>
<section id="model-fitting" class="level4">
<h4 class="anchored" data-anchor-id="model-fitting">Model Fitting</h4>
<p>Our strategy of finding two best models is to run a loop for all parameters and sort out the two models with Lowest AICc value.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qpcR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## Loading required package: MASS

## Loading required package: minpack.lm

## Loading required package: rgl

## Loading required package: robustbase

## Loading required package: Matrix</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"p d q P D Q"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] "p d q P D Q"</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">5</span>)){</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (d <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>)){</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (q <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">5</span>)){</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (P <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)){</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> (D <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>)){</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> (Q <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)){</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">print</span>(<span class="fu">c</span>(p,d,q,P,D,Q))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">print</span>(<span class="fu">AICc</span>(<span class="fu">arima</span>(employees.training,<span class="at">order =</span> <span class="fu">c</span>(p,d,q),<span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(P,D,Q), <span class="at">period =</span> <span class="dv">12</span>), <span class="at">method=</span><span class="st">"ML"</span>))) </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 0 1 0 0 1 0
## [1] 2071.736
## [1] 0 1 0 0 1 1
## [1] 1964.109
## [1] 0 1 0 1 1 0
## [1] 2005.71
## [1] 0 1 0 1 1 1
## [1] 1965.466
## [1] 0 1 2 0 1 0
## [1] 2069.902
## [1] 0 1 2 0 1 1
## [1] 1957.807
## [1] 0 1 2 1 1 0
## [1] 1998.389
## [1] 0 1 2 1 1 1
## [1] 1959.746
## [1] 0 1 5 0 1 0
## [1] 2068.476
## [1] 0 1 5 0 1 1
## [1] 1951.655
## [1] 0 1 5 1 1 0
## [1] 1994.53
## [1] 0 1 5 1 1 1
## [1] 1953.647
## [1] 2 1 0 0 1 0
## [1] 2068.952
## [1] 2 1 0 0 1 1
## [1] 1955.055
## [1] 2 1 0 1 1 0
## [1] 1996.201
## [1] 2 1 0 1 1 1
## [1] 1957.103
## [1] 2 1 2 0 1 0
## [1] 2069.071
## [1] 2 1 2 0 1 1
## [1] 1935.809
## [1] 2 1 2 1 1 0

## Warning in log(s2): NaNs produced

## [1] 1987.449
## [1] 2 1 2 1 1 1
## [1] 1937.051
## [1] 2 1 5 0 1 0
## [1] 2051.824
## [1] 2 1 5 0 1 1
## [1] 1940.756
## [1] 2 1 5 1 1 0
## [1] 1986.338
## [1] 2 1 5 1 1 1
## [1] 1942.19
## [1] 5 1 0 0 1 0
## [1] 2066.573
## [1] 5 1 0 0 1 1
## [1] 1943.759
## [1] 5 1 0 1 1 0
## [1] 1988.936
## [1] 5 1 0 1 1 1
## [1] 1945.227
## [1] 5 1 2 0 1 0
## [1] 2068.298
## [1] 5 1 2 0 1 1
## [1] 1941.005
## [1] 5 1 2 1 1 0
## [1] 1988.373
## [1] 5 1 2 1 1 1
## [1] 1942.421
## [1] 5 1 5 0 1 0
## [1] 2035.202
## [1] 5 1 5 0 1 1

## Warning in log(s2): NaNs produced

## [1] 1942.859
## [1] 5 1 5 1 1 0
## [1] 1981.359
## [1] 5 1 5 1 1 1
## [1] 1946.23</code></pre>
<p>Below are three models with the least AICc values, we can see that there AICc values are very close, and parameters are also similar.</p>
<p><span class="math display">\[
\\operatorname{SARIMA}(5,1,2)\\times(0,1,1)\_{12}\\\\
\\operatorname{SARIMA}(2,1,2)\\times(0,1,1)\_{12}\\\\
\]</span></p>
<section id="model-1-sarima-512-11012" class="level5">
<h5 class="anchored" data-anchor-id="model-1-sarima-512-11012">Model 1 SARIMA (5,1,2) × (1,1,0)<sub>12</sub></h5>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">arima</span>(employees.training,<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">period =</span> <span class="dv">12</span>), <span class="at">method=</span><span class="st">"ML"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>model1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## arima(x = employees.training, order = c(5, 1, 2), seasonal = list(order = c(0, 
##     1, 1), period = 12), method = "ML")
## 
## Coefficients:
##          ar1      ar2      ar3     ar4     ar5      ma1     ma2     sma1
##       0.8938  -0.0710  -0.0136  0.0108  0.0732  -0.9494  0.2416  -0.7474
## s.e.  0.7132   0.4798   0.1344  0.0810  0.0841   0.7145  0.5126   0.0438
## 
## sigma^2 estimated as 28.02:  log likelihood = -961.27,  aic = 1940.55</code></pre>
<p>And we see that 0 is in the confidence interval of ar2, ar3, ar4, ar5, ma2, so we run</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AICc</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 1941.005</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AICc</span>(<span class="fu">arima</span>(employees.training,<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">period =</span> <span class="dv">12</span>), <span class="at">method=</span><span class="st">"ML"</span>,<span class="at">fixed=</span> <span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="cn">NA</span>,<span class="dv">0</span>,<span class="cn">NA</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## Warning in arima(employees.training, order = c(5, 1, 2), seasonal = list(order =
## c(0, : some AR parameters were fixed: setting transform.pars = FALSE

## Warning in log(s2): NaNs produced

## [1] 1942.025</code></pre>
<p>But this does not decrease the AICc, so we will stick to our original model.</p>
</section>
<section id="model-2-sarima-212-11012" class="level5">
<h5 class="anchored" data-anchor-id="model-2-sarima-212-11012">Model 2 SARIMA (2,1,2) × (1,1,0)<sub>12</sub></h5>
<div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">arima</span>(employees.training,<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">period =</span> <span class="dv">12</span>), <span class="at">method=</span><span class="st">"ML"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## Warning in log(s2): NaNs produced</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>model2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## arima(x = employees.training, order = c(2, 1, 2), seasonal = list(order = c(1, 
##     1, 0), period = 12), method = "ML")
## 
## Coefficients:
##          ar1     ar2      ma1      ma2     sar1
##       0.5338  0.3358  -0.5788  -0.1315  -0.5004
## s.e.  0.3456  0.3175   0.3638   0.3059   0.0499
## 
## sigma^2 estimated as 33.88:  log likelihood = -987.63,  aic = 1987.26</code></pre>
<p>And we see that 0 is in the confidence interval of ma2, so we run</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AICc</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 1987.449</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AICc</span>(<span class="fu">arima</span>(employees.training,<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">period =</span> <span class="dv">12</span>),<span class="at">fixed =</span> <span class="fu">c</span>(<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="cn">NA</span>), <span class="at">method=</span><span class="st">"ML"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 1996.315</code></pre>
<p>Again, fixing parameter did not decrease AICc, so we will stick to our original model.</p>
</section>
</section>
<section id="diagonstics-for-model-1" class="level4">
<h4 class="anchored" data-anchor-id="diagonstics-for-model-1">Diagonstics for model 1</h4>
<p>The equation for the first model is</p>
<p>(1−<em>ϕ</em><sub>1</sub><em>B</em>−<em>ϕ</em><sub>2</sub><em>B</em><sup>2</sup>−<em>ϕ</em><sub>3</sub><em>B</em><sup>3</sup>−<em>ϕ</em><sub>4</sub><em>B</em><sup>4</sup>−<em>ϕ</em><sub>5</sub><em>B</em><sup>5</sup>)(1−<em>Φ</em><sub>1</sub><em>B</em><sup>12</sup>)(1−<em>B</em>)(1−<em>B</em><sup>12</sup>)<em>y</em><sub><em>t</em></sub> = (1+<em>θ</em><sub>1</sub><em>B</em>+<em>θ</em><sub>2</sub><em>B</em><sup>2</sup>)<em>Z</em><sub><em>t</em></sub></p>
<p>substituting the parameters, we have</p>
<p>(1−0.8938<em>B</em>+0.0710<em>B</em><sup>2</sup>+0.0136<em>B</em><sup>3</sup>−0.0108<em>B</em><sup>4</sup>−0.0732<em>B</em><sup>5</sup>)(1+0.7474<em>B</em><sup>12</sup>)(1−<em>B</em>)(1−<em>B</em><sup>12</sup>)<em>y</em><sub><em>t</em></sub> = (1−0.9494<em>B</em>+0.2416<em>B</em><sup>2</sup>)<em>Z</em><sub><em>t</em></sub></p>
<section id="stationarity" class="level5">
<h5 class="anchored" data-anchor-id="stationarity">Stationarity</h5>
<div class="sourceCode" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"plot.roots.R"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.roots</span>(<span class="cn">NULL</span>,<span class="fu">polyroot</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.8398</span>, <span class="fl">0.0710</span>, <span class="fl">0.0136</span>,<span class="sc">-</span><span class="fl">0.0108</span>,<span class="sc">-</span><span class="fl">0.0732</span>)), <span class="at">main=</span><span class="st">"Model 1, roots of AR part, nonseasonal "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-19-1.png" class="img-fluid"></p>
<p>Clearly, all AR roots are outside of unit circle, but we also have |<em>Φ</em><sub>1</sub>| &lt; 1 so the model is stationary.</p>
</section>
<section id="invertibility" class="level5">
<h5 class="anchored" data-anchor-id="invertibility">Invertibility</h5>
<div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.roots</span>(<span class="cn">NULL</span>,<span class="fu">polyroot</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.9494</span>,<span class="fl">0.2416</span>)), <span class="at">main=</span><span class="st">"Model 1, roots of ma part, nonseasonal "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-20-1.png" class="img-fluid"></p>
<p>Clearly, all MA (seasonal and non seasonal) roots are outside of unit circle, so the model is invertible.</p>
</section>
<section id="analyzing-the-residues" class="level5">
<h5 class="anchored" data-anchor-id="analyzing-the-residues">Analyzing the Residues</h5>
<p>We first look at the histogram of the Residues</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>model1_res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model1)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(model1_res,<span class="at">density=</span><span class="dv">20</span>,<span class="at">breaks=</span><span class="dv">20</span>, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">xlab=</span><span class="st">"Histogram of Residues"</span>, <span class="at">prob=</span><span class="cn">TRUE</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(model1_res)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>std1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(model1_res))</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x,m1,std1), <span class="at">add=</span><span class="cn">TRUE</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-21-1.png" class="img-fluid"></p>
<p>Which looks pretty normal, despite a larger peak at the center. Next we will plot out the Residues</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(model1_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 0.2589183</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(model1_res)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>fit_res_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(model1_res <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(model1_res))) </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit_res_1, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">mean</span>(model1_res), <span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-22-1.png" class="img-fluid"></p>
<p>The mean is just 0.25 which is very close to 0.</p>
<p>Now we plot out a QQ Plot for the Residues</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(model1_res,<span class="at">main=</span> <span class="st">"Normal Q-Q Plot for Model 1"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(model1_res,<span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-23-1.png" class="img-fluid"></p>
<p>which aligns quite well on a straight line.</p>
<p>We see that from the above plots, <strong>there is no trend, and no visible change of variance, and no seasonality, and the sample mean = 0.25 is almost zero. The histogram and the QQ plot looks okay.</strong></p>
<p>Now, we will plot out ACF and PACF of the Residues</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(model1_res, <span class="at">lag.max=</span><span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-24-1.png" class="img-fluid"></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(model1_res, <span class="at">lag.max=</span><span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-25-1.png" class="img-fluid"></p>
<p>All acf and pacf of residuals <strong>are within confidence intervals</strong> (except acf at lag 15 and 21 but they are negiglible) and can be counted as zeros.</p>
<p>Now we will check if this model can pass the tests.</p>
</section>
<section id="shapiro-wilk-normality-test" class="level5">
<h5 class="anchored" data-anchor-id="shapiro-wilk-normality-test">Shapiro-Wilk Normality Test</h5>
<div class="sourceCode" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(model1_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  model1_res
## W = 0.9643, p-value = 4.028e-07</code></pre>
<p>Since the p-value is within the significant level, the model fails the shapiro wilk normality test.</p>
</section>
<section id="box-pierce-test" class="level5">
<h5 class="anchored" data-anchor-id="box-pierce-test">Box-Pierce test</h5>
<p>With degree of freedom 12 − (5+2) = 7,</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(model1_res, <span class="at">lag =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"Box-Pierce"</span>), <span class="at">fitdf =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
##  Box-Pierce test
## 
## data:  model1_res
## X-squared = 5.4354, df = 5, p-value = 0.3651</code></pre>
<p>We see that the model passes the Box-Pierce test, p-value is larger than significant level</p>
</section>
<section id="box-ljung-test" class="level5">
<h5 class="anchored" data-anchor-id="box-ljung-test">Box-Ljung test</h5>
<div class="sourceCode" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(model1_res, <span class="at">lag =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"Ljung-Box"</span>), <span class="at">fitdf =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
##  Box-Ljung test
## 
## data:  model1_res
## X-squared = 5.6024, df = 5, p-value = 0.3468</code></pre>
<p>We see that the model passes the Box-Ljung test, p-value is larger than significant level.</p>
</section>
<section id="mc-leod-li-test" class="level5">
<h5 class="anchored" data-anchor-id="mc-leod-li-test">Mc-Leod Li test</h5>
<div class="sourceCode" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>((model1_res)<span class="sc">^</span><span class="dv">2</span>, <span class="at">lag =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"Ljung-Box"</span>), <span class="at">fitdf =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
##  Box-Ljung test
## 
## data:  (model1_res)^2
## X-squared = 45.324, df = 12, p-value = 9.069e-06</code></pre>
<p>the model fails the mc-leod Li test.</p>
</section>
<section id="yule-walker-or-mle-estimation" class="level5">
<h5 class="anchored" data-anchor-id="yule-walker-or-mle-estimation">Yule-Walker (or MLE) estimation</h5>
<div class="sourceCode" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ar</span>(model1_res, <span class="at">aic =</span> <span class="cn">TRUE</span>, <span class="at">order.max =</span> <span class="cn">NULL</span>, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"yule-walker"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## ar(x = model1_res, aic = TRUE, order.max = NULL, method = c("yule-walker"))
## 
## 
## Order selected 0  sigma^2 estimated as  26.95</code></pre>
<p>Fitted residuals to AR(0), i.e.&nbsp;WN.</p>
<p>So the model passes all the test but <strong>mc-leod Li</strong> and <strong>Shapiro-Wilk Normality Test</strong></p>
</section>
</section>
<section id="diagonstics-for-model-2" class="level4">
<h4 class="anchored" data-anchor-id="diagonstics-for-model-2">Diagonstics for model 2</h4>
<p>The equation for the second model is</p>
<p>(1−<em>ϕ</em><sub>1</sub><em>B</em>−<em>ϕ</em><sub>2</sub><em>B</em><sup>2</sup>)(1−<em>Φ</em><sub>12</sub><em>B</em><sup>12</sup>)(1−<em>L</em>)(1−<em>B</em><sup>12</sup>)<em>y</em><sub><em>t</em></sub> = (1+<em>θ</em><sub>1</sub><em>B</em>+<em>θ</em><sub>2</sub><em>B</em><sup>2</sup>)<em>Z</em><sub><em>t</em></sub></p>
<p>substituting the parameters, we have</p>
<p>(1−0.5338<em>B</em>−0.3358<em>B</em><sup>2</sup>)(1+0.5004<em>B</em><sup>12</sup>)(1−<em>L</em>)(1−<em>B</em><sup>12</sup>)<em>y</em><sub><em>t</em></sub> = (1−0.5788<em>B</em>−0.1315<em>B</em><sup>2</sup>)<em>Z</em><sub><em>t</em></sub></p>
<section id="stationarity-1" class="level5">
<h5 class="anchored" data-anchor-id="stationarity-1">Stationarity</h5>
<div class="sourceCode" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.roots</span>(<span class="cn">NULL</span>,<span class="fu">polyroot</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5338</span>, <span class="sc">-</span><span class="fl">0.3358</span>)), <span class="at">main=</span><span class="st">"Model 1, roots of AR part, nonseasonal "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-31-1.png" class="img-fluid"></p>
<p>Clearly, all AR roots are outside of unit circle, but we also have |<em>Φ</em><sub>1</sub>| &lt; 1 so the model is stationary.</p>
</section>
<section id="invertibility-1" class="level5">
<h5 class="anchored" data-anchor-id="invertibility-1">Invertibility</h5>
<div class="sourceCode" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.roots</span>(<span class="cn">NULL</span>,<span class="fu">polyroot</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5788</span>,<span class="sc">-</span><span class="fl">0.1315</span>)), <span class="at">main=</span><span class="st">"Model 1, roots of MA part, nonseasonal "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-32-1.png" class="img-fluid"></p>
<p>Clearly, all MA roots are outside of unit circle, so the model is invertible.</p>
</section>
<section id="analyzing-the-residues-1" class="level5">
<h5 class="anchored" data-anchor-id="analyzing-the-residues-1">Analyzing the Residues</h5>
<p>We first look at the histogram of the Residues</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>model2_res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model2)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(model2_res,<span class="at">density=</span><span class="dv">20</span>,<span class="at">breaks=</span><span class="dv">20</span>, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">xlab=</span><span class="st">"Histogram of Residues"</span>, <span class="at">prob=</span><span class="cn">TRUE</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(model2_res)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>std1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(model2_res))</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x,m1,std1), <span class="at">add=</span><span class="cn">TRUE</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-33-1.png" class="img-fluid"></p>
<p>Which looks pretty normal, despite a larger peak at the center. Next we will plot out the Residues</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(model2_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 0.1359044</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(model2_res)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>fit_res_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(model2_res <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(model2_res))) </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit_res_1, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">mean</span>(model2_res), <span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-34-1.png" class="img-fluid"></p>
<p>The mean is just 0.135 which is very close to 0.</p>
<p>Now we plot out a QQ Plot for the Residues</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(model2_res,<span class="at">main=</span> <span class="st">"Normal Q-Q Plot for Model 1"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(model2_res,<span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-35-1.png" class="img-fluid"></p>
<p>which aligns quite well on a straight line.</p>
<p>We see that from the above plots, <strong>there is no trend, and no visible change of variance, and no seasonality, and the sample mean = 0.13 is almost zero. The histogram and the QQ plot looks okay.</strong></p>
<p>Now, we will plot out ACF and PACF of the Residues</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(model2_res, <span class="at">lag.max=</span><span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-36-1.png" class="img-fluid"></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(model2_res, <span class="at">lag.max=</span><span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-37-1.png" class="img-fluid"></p>
<p>All acf and pacf of residuals <strong>are within confidence intervals</strong> (except at lag 12 and 24), this means that there is seasonality in the residues.</p>
<p>Now we will check if this model can pass the tests.</p>
</section>
<section id="shapiro-wilk-normality-test-1" class="level5">
<h5 class="anchored" data-anchor-id="shapiro-wilk-normality-test-1">Shapiro-Wilk Normality Test</h5>
<div class="sourceCode" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(model2_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  model2_res
## W = 0.9668, p-value = 9.534e-07</code></pre>
<p>Since the p-value is within the significant level, the model fails the shapiro wilk normality test.</p>
</section>
<section id="box-pierce-test-1" class="level5">
<h5 class="anchored" data-anchor-id="box-pierce-test-1">Box-Pierce test</h5>
<p>With degree of freedom 12 − (5+2) = 7,</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(model2_res, <span class="at">lag =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"Box-Pierce"</span>), <span class="at">fitdf =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
##  Box-Pierce test
## 
## data:  model2_res
## X-squared = 16.06, df = 8, p-value = 0.04152</code></pre>
<p>We see that the model fails the Box-Pierce test</p>
</section>
<section id="box-ljung-test-1" class="level5">
<h5 class="anchored" data-anchor-id="box-ljung-test-1">Box-Ljung test</h5>
<div class="sourceCode" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(model2_res, <span class="at">lag =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"Ljung-Box"</span>), <span class="at">fitdf =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
##  Box-Ljung test
## 
## data:  model2_res
## X-squared = 16.595, df = 8, p-value = 0.03461</code></pre>
<p>We see that the model fails the Box-Ljung test.</p>
</section>
<section id="mc-leod-li-test-1" class="level5">
<h5 class="anchored" data-anchor-id="mc-leod-li-test-1">Mc-Leod Li test</h5>
<div class="sourceCode" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>((model2_res)<span class="sc">^</span><span class="dv">2</span>, <span class="at">lag =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"Ljung-Box"</span>), <span class="at">fitdf =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
##  Box-Ljung test
## 
## data:  (model2_res)^2
## X-squared = 69.624, df = 12, p-value = 3.766e-10</code></pre>
<p>the model fails the mc-leod Li test.</p>
</section>
<section id="yule-walker-or-mle-estimation-1" class="level5">
<h5 class="anchored" data-anchor-id="yule-walker-or-mle-estimation-1">Yule-Walker (or MLE) estimation</h5>
<div class="sourceCode" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ar</span>(model2_res, <span class="at">aic =</span> <span class="cn">TRUE</span>, <span class="at">order.max =</span> <span class="cn">NULL</span>, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"yule-walker"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## ar(x = model2_res, aic = TRUE, order.max = NULL, method = c("yule-walker"))
## 
## Coefficients:
##       1        2        3        4        5        6        7        8  
## -0.0179  -0.0146  -0.0153   0.0003   0.0676   0.0636  -0.0170   0.0557  
##       9       10       11       12       13       14       15       16  
##  0.0711   0.0177   0.0014  -0.1784  -0.0092  -0.0107   0.1019  -0.0223  
##      17       18       19       20       21       22       23       24  
##  0.0121  -0.0302  -0.0697   0.0228   0.0789  -0.0331  -0.0177  -0.2693  
## 
## Order selected 24  sigma^2 estimated as  30.04</code></pre>
<p>Did not fitted residuals to AR(0), i.e.&nbsp;WN.</p>
<p>So the model 2 <strong>fails all the tests</strong></p>
</section>
</section>
<section id="conclusion-for-diagnostics" class="level4">
<h4 class="anchored" data-anchor-id="conclusion-for-diagnostics">Conclusion for diagnostics</h4>
<p>We have model 1 passes all the test but <strong>Mc-leod Li</strong> and <strong>Shapiro-Wilk Normality Test</strong>. And model 2 fails all the tests. Notice that</p>
<pre><code>Besides model 1, and model 2, I have ran the diagnostics with all top 10 models with lowest AICc values and none of them passes the Mc-Leod Li test and the Shapiro-Wilk Normality Test. This may due to the fact that there is a sequence of anomaly datapoint between 2008 and 2009, causing deviation in fitting the model, and therefore failing the Mc-leod Li and Shapiro-Wilk Normality Test.</code></pre>
<p>Therefore, I will choose model 1 as my final model, since it has a lowest AICc value, and passes most of the tests.</p>
<p><span class="math display">\[
\\operatorname{SARIMA}(5,1,2)\\times(0,1,1)\_{12}\\\\
\]</span></p>
<p>as our final model, where</p>
<p>(1−0.8938<em>B</em>+0.0710<em>B</em><sup>2</sup>+0.0136<em>B</em><sup>3</sup>−0.0108<em>B</em><sup>4</sup>−0.0732<em>B</em><sup>5</sup>)(1+0.7474<em>B</em><sup>12</sup>)(1−<em>B</em>)(1−<em>B</em><sup>12</sup>)<em>y</em><sub><em>t</em></sub> = (1−0.9494<em>B</em>+0.2416<em>B</em><sup>2</sup>)<em>Z</em><sub><em>t</em></sub></p>
</section>
</section>
<section id="forcasting-with-final-model" class="level3">
<h3 class="anchored" data-anchor-id="forcasting-with-final-model">Forcasting with final model</h3>
<p>Now we will try to forecast two year (24 datapoints) using our final model, we use red circles to denote the forecast values and blue dashed lines as our confidence interval</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## Registered S3 method overwritten by 'quantmod':
##   method            from
##   as.zoo.data.frame zoo

## Registered S3 methods overwritten by 'forecast':
##   method                 from     
##   autoplot.Arima         ggfortify
##   autoplot.acf           ggfortify
##   autoplot.ar            ggfortify
##   autoplot.bats          ggfortify
##   autoplot.decomposed.ts ggfortify
##   autoplot.ets           ggfortify
##   autoplot.forecast      ggfortify
##   autoplot.stl           ggfortify
##   autoplot.ts            ggfortify
##   fitted.ar              ggfortify
##   fortify.ts             ggfortify
##   residuals.ar           ggfortify</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>pred.tr <span class="ot">&lt;-</span> <span class="fu">predict</span>(model1, <span class="at">n.ahead =</span> <span class="dv">24</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>U.tr<span class="ot">=</span> pred.tr<span class="sc">$</span>pred <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>pred.tr<span class="sc">$</span>se</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>L.tr<span class="ot">=</span> pred.tr<span class="sc">$</span>pred <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>pred.tr<span class="sc">$</span>se</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(employees.training, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">length</span>(employees.training)<span class="sc">+</span><span class="dv">12</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(employees.training),<span class="fu">max</span>(U.tr)))</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(U.tr, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lty=</span><span class="st">"dashed"</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(L.tr, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lty=</span><span class="st">"dashed"</span>)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>((<span class="fu">length</span>(employees.training)<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(employees.training)<span class="sc">+</span><span class="dv">24</span>), pred.tr<span class="sc">$</span>pred, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-43-1.png" class="img-fluid"></p>
<p>Which looks pretty good, we can further verify if our testing data is within the confidence interval with a zoomed view.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(employees, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">240</span>,<span class="fu">length</span>(employees.training)<span class="sc">+</span><span class="dv">24</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1400</span>,<span class="fu">max</span>(U.tr)), <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(U.tr, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lty=</span><span class="st">"dashed"</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(L.tr, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lty=</span><span class="st">"dashed"</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>((<span class="fu">length</span>(employees.training)<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(employees.training)<span class="sc">+</span><span class="dv">24</span>),  pred.tr<span class="sc">$</span>pred , <span class="at">col=</span><span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="pstat174-final-project_files/figure-markdown_github/unnamed-chunk-44-1.png" class="img-fluid"></p>
<p>As we can see, the forecast values are now black circles, and the red line is the true values. We see that <strong>the test set is within the confidence interval</strong>. Even though that the model constantly <strong>underestimated</strong> the values in the forecast.</p>
</section>
<section id="spectral-analysis" class="level3">
<h3 class="anchored" data-anchor-id="spectral-analysis">Spectral Analysis</h3>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>